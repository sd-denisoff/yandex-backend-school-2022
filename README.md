# Отборочное задание в ШБР Яндекс 2022

> ![](https://img.shields.io/badge/Track-Python-yellow)
> ![](https://img.shields.io/badge/Framework-Django-lightgreen)
> ![](https://img.shields.io/badge/Database-PostgreSQL-orange)
> ![](https://img.shields.io/badge/Tools-Docker-blue)

* [Описание задания](#problem)
* [Описание решения](#solution)
    * [Фреймворк](#framework)
    * [База данных](#database)
    * [Обертка](#wrapper)
* [Инструкции](#guides)
    * [Сборка и запуск приложения](#launch-app)
    * [Запуск тестов](#launch-tests)
* [Справка](#additional)

___

## <a name="problem"></a> Описание задания

Разработать REST API сервис, который позволяет магазинам загружать и обновлять информацию о товарах, а пользователям -
смотреть какие товары были обновлены за последние сутки, а также следить за динамикой цен товара или категории за
указанный интервал времени.

С подробным описанием задания можно ознакомиться [по ссылке](./Task.md).

## <a name="solution"></a> Описание решения

**TL;DR** Для разработки решения я использовал `Python` и веб-фреймворк `Django`. В качестве базы данных я
выбрал `PostgreSQL` и развернул ее внутри `Docker` контейнера, в который было упаковано и все приложение целиком. На
сервере реализован unit, выполняющий автоматический запуск приложения при рестарте контейнера.

Реализованные обработчики отвечают спецификации, определенной составителем задания.

#### <a name="framework"></a> Фреймворк

Выбор фреймворка `Django` обоснован лишь тем, что мой опыт разработки чаще всего был связан именно с ним. Также
некоторые собственные pet-проекты пробовал писать на Flask и FastAPI.  
К сожалению, требование по обработке нескольких запросов одовременно я заметил перед сдачей работы. В таком случае лучше
было бы выбрать асинхронный фреймворк. Сам `Django` в последних версиях поддерживает асинхронное взаимодействие, однако
модуль DRF для написания REST API [все еще нет](https://github.com/encode/django-rest-framework/discussions/7774) (а
именно он использовался для реализации).
В связи с этим было принято решение не переделывать проект под другой фреймфорк (например, FastAPI) для поддержки
асинхронности. В случае необходимости это с легкостью можно заложить при выборе стека и разработке архитектуры сервиса,
в целом бизнес-логика останется той же. В моем решении обработка нескольких запросов будет достигаться путем
распараллеливания процесоов с помощью `gunicorn` (подробнее [здесь](#wrapper)).

#### <a name="database"></a> База данных

Согласно рекомендациям в условии задания была развернута база данных `PostgreSQL` внутри контейнера. Для обеспечения
персистентности был подмонтирован каталог pgdata, в котором сохраняется состояние БД.

Изначально я планировал разложить данные по разным таблицам в БД (ведь логически товар и категория – разные сущности).
Архитектурно это было бы правильно. Однако для упрощения кода, воспользовавшиcь тем, что все id уникальны
среди товаров и категорий, я принял решение хранить данные в единой таблице `Item`:

| Поле   | Тип           |
|--------|---------------|
| id     | CharField     |
| name   | CharField     |
| type   | CharField     |
| parent | ForeignKey    | 
| price  | IntegerField  | 
| date   | DateTimeField |

#### <a name="wrapper"></a> Обертка

Приложение было упаковано в `Docker` контейнер, собранный на основе образа `alpine`. Сборка и запуск проекта, а также
развертывание базы данных производятся автоматизировано одной командой. WSGI-сервер запускается с помощью `gunicorn`. Он
же используется для обработки нескольких запросов одновременно (кол-во workers выбрано по стандартному правилу `2 x
num_cores + 1`). На сервере реализован `unit`, выполняющий автоматический запуск приложения при рестарте контейнера.
Также для удобства работы с проектом все необходимые команды обернуты в `make`.

## <a name="guides"></a> Инструкции

### <a name="launch-app"></a> Сборка и запуск приложения

Благодаря контейнеризации с помощью Docker, собрать и запустить проект можно всего за несколько команд.

1. Склонируйте репозиторий и перейдите в директорию с проектом
   ```bash
   $ git clone https://github.com/sd-denisoff/yandex-backend-school-2022.git && cd yandex-backend-school-2022
   ```

2. Добавьте файл `Products/.env` c переменными, заданными согласно формату файла `Products/.env.example`.

3. Выполните миграции
   ```bash
   $ make migrate
   ```

4. Запустите сервер
   ```bash
   $ make run
   ```

Приложение будет доступно на `localhost:80`

### <a name="launch-tests"></a> Запуск тестов

   ```bash
   $ python -m pytest tests
   ```

## <a name="additional"></a> Справка

- Просмотр Swagger UI – `/doc`
- Все доступные команды make – `make all`
- [Условие задания](./Task.md)

Developed by [Денисов Степан](https://t.me/sd_denisoff 'telegram')
